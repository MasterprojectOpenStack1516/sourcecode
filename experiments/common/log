#!/bin/bash

if ( [ "$1" == "-h" ] || [ "$1" == "--help" ] )
then
  echo '-h --help        display this help and exit'
  echo '-v               use logging_level "v"'
  echo '-vv              use logging_level "vv"'
  echo '-vvv             use logging_level "vvv"'
  echo '-i --input       output the stdin'
  exit 0
fi

if ! ( [ "$logging_level" == "v" ]   || \
	   [ "$logging_level" == "vv" ]  || \
	   [ "$logging_level" == "vvv" ] )
then
  >&2 echo 'ERROR: Variable $logging_level should be se to "v", "vv" or, "vvv".'
  exit 1
fi

function print {
	echo -n X"$1" | tail -c +2
}

# using shift according to 
# http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_09_07.html

use_stdout=false
has_output=false
output_from_arguments=''

while (( "$#" )); do
  if [ "-$logging_level" == "$1" ]
  then
    if [ "$has_output" == "true" ]
    then
      print "$output_from_arguments "
    fi
    use_stdout=true
  elif ( [ "$1" == '--input' ] || [ "$1" == "-i" ])
  then
    cat 
  elif ( [ "$1" == "-v" ]   || \
	     [ "$1" == "-vv" ]  || \
	     [ "$1" == "-vvv" ] )
  then
    # do not use the argument
    ( : )
  else
    # print the argument
    if [ "$use_stdout" == false ]
    then
      if [ "$has_output" == "false" ]
      then
        output_from_arguments="$1"
      else
        output_from_arguments="$output_from_arguments $1"
      fi
      has_output=true
    else
      print "$1 "
    fi
  fi

  # use next argument
  shift
done

if [ "$use_stdout" == "true" ]
then
  # print last newline
  echo
fi