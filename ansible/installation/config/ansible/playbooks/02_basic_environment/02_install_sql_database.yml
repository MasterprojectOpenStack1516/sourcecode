---
- hosts: controller
  gather_facts: False
  sudo: yes
  roles:
  - config
  tasks:
  - name: "ERROR: perl: warning: Please check that your locale settings"
    shell: locale-gen de_DE.UTF-8; update-locale LANG=de_DE.UTF-8
  - name: install and configure the database server
    apt: 
      pkg: mariadb-server
      state: installed 
  - apt: 
      pkg: python-mysqldb
      state: installed 
  - name: add sql server on controller to configuration
    lineinfile: 
      dest: /etc/mysql/conf.d/mysqld_openstack.cnf
      create: yes
# using variables 
#   https://docs.ansible.com/playbooks_variables.html#information-discovered-from-systems-facts
#   Use "ansible controller -m setup" to find all possible variable names.
#   Other variable names are defined in the config role.
#     {{ config.controller_node_ip_address }}
      line: "[mysqld]\nbind-address = {{ config.controller_node_ip_address }}\n\ndefault-storage-engine = innodb\ninnodb_file_per_table\ncollation-server = utf8_general_ci\ninit-connect = \'SET NAMES utf8\'\ncharacter-set-server = utf8"
  - name: restart mysql
    service: 
      name: mysql
      state: restarted

# this playbook was created according to
# http://docs.openstack.org/kilo/install-guide/install/apt/content/ch_basic_environment.html

